<script src="blockly_compressed.js"></script>
<script src="blocks_compressed.js"></script>

<script src="msg/js/en.js"></script>

<a id="downloadAnchorElem" style="display:none"></a>


<div id="blocklyDiv" style="height: 480px; width: 600px"></div>

<button onclick="download()">Download</button>


<xml id="toolbox" style="display: none">
  <!--
  <block type="controls_if"></block>
  <block type="controls_repeat_ext"></block>
  <block type="logic_compare"></block>
  <block type="math_number"></block>
  <block type="math_arithmetic"></block>
  <block type="text"></block>
  <block type="text_print"></block>

-->
    <category name="TestCategory">
        <block type="gui_click"></block>
        <block type="gui_moverel"></block>
        <block type="gui_dragto"></block>
    	<block type="gui_dragrel"></block>
		<block type="gui_scroll"></block>
		<block type="gui_mousedown"></block>
		<block type="gui_mouseup"></block>
	</category>
	<category name="Number">
		<block type="math_number"></block>
	</category>
</xml>

<script>
    var workspace = Blockly.inject('blocklyDiv', {toolbox: document.getElementById('toolbox')});

    function saveJSON(data, filename){
			if(!data) {
				console.error('No data')
				return;
			}

			if(!filename) filename = 'console.json'

			if(typeof data === "object"){
				data = JSON.stringify(data, undefined, 4)
			}

			var blob = new Blob([data], {type: 'text/json'}),
				e    = document.createEvent('MouseEvents'),
				a    = document.createElement('a')

			a.download = filename
			a.href = window.URL.createObjectURL(blob)
			a.dataset.downloadurl =  ['text/json', a.download, a.href].join(':')
			e.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null)
			a.dispatchEvent(e)
	}

    function download(){
		var mainws = Blockly.getMainWorkspace();
		var blocks = mainws.getAllBlocks();

		var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(blocks));
		var dlAnchorElem = document.getElementById('downloadAnchorElem');
		dlAnchorElem.setAttribute("href",     dataStr     );
		dlAnchorElem.setAttribute("download", "scene.json");
		dlAnchorElem.click();
	}

    Blockly.Blocks['gui_click'] = {
    init: function() {
      this.appendDummyInput()
          .appendField("mouse click");
      this.appendDummyInput()
          .appendField(new Blockly.FieldDropdown([["left","left"], ["right","right"], ["centre","centre"]]), "mouse_button");
      this.setInputsInline(true);
      this.setPreviousStatement(true, null);
      this.setNextStatement(true, null);
      this.setColour(210);
   this.setTooltip("");
   this.setHelpUrl("");
    }
  };

    Blockly.Blocks['gui_moveto'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("move cursor to");
          this.appendValueInput("x_pos")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("x postion");
          this.appendValueInput("y_pos")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("y position");
          this.appendDummyInput()
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("over")
              .appendField(new Blockly.FieldNumber(0), "time_duration")
              .appendField("seconds");
          this.setInputsInline(false);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
       this.setTooltip("");
       this.setHelpUrl("");
        }
      };

    Blockly.Blocks['gui_moverel'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("move cursor relative to position");
          this.appendValueInput("x_change")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("x change");
          this.appendValueInput("y_change")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("y change");
          this.appendDummyInput()
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("over")
              .appendField(new Blockly.FieldNumber(0), "time_duration")
              .appendField("seconds");
          this.setInputsInline(false);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

    Blockly.Blocks['gui_dragto'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("drag cursor to");
          this.appendValueInput("x_pos")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("x position");
          this.appendValueInput("y_pos")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("y position");
          this.appendDummyInput()
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("over")
              .appendField(new Blockly.FieldNumber(0), "time_duration")
              .appendField("seconds");
          this.setInputsInline(false);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

    Blockly.Blocks['gui_dragrel'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("drag cursor relative to position");
          this.appendValueInput("x_change")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("x change");
          this.appendValueInput("y_change")
              .setCheck("Number")
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("y change");
          this.appendDummyInput()
              .setAlign(Blockly.ALIGN_RIGHT)
              .appendField("over")
              .appendField(new Blockly.FieldNumber(0), "time_duration")
              .appendField("seconds");
          this.setInputsInline(false);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

    Blockly.Blocks['gui_scroll'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("");
          this.appendDummyInput()
              .appendField("scroll amount (+ve srolls up)")
              .appendField(new Blockly.FieldNumber(0), "scroll_amount");
          this.setInputsInline(true);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

    Blockly.Blocks['gui_mousedown'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("Mouse down");
          this.appendDummyInput()
              .appendField(new Blockly.FieldDropdown([["left","left"], ["right","right"], ["centre","centre"]]), "mouse_button");
          this.setInputsInline(true);
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

    Blockly.Blocks['gui_mouseup'] = {
        init: function() {
          this.appendDummyInput()
              .appendField("Mouse up");
          this.appendDummyInput()
              .appendField(new Blockly.FieldDropdown([["left","left"], ["right","right"], ["centre","centre"]]), "mouse_button");
          this.setInputsInline(true);
          this.setPreviousStatement(true);
          this.setNextStatement(true);
          this.setColour(210);
        this.setTooltip("");
        this.setHelpUrl("");
        }
    };

</script>
